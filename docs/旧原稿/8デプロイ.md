さて前回の章までで、Netflixクローンのアプリケーションは出来たと思います。

今回はそれをデプロイして公開していきましょう。

## 8-1 デプロイはVercelを使う
この教材を最初に作った2021年段階ではfirebaseを使っていましたが、今回はVercelを使っていきます。

と言ってもこの辺りは好みで問題ないので、教材から離れて自分でサービスを調べつつ手を動かしてもOKです。

以下、主なホスティングサービスの選択肢です。

- Vercel(今回はコレ)
- Netlify
- GitHub Pages

この記事に詳細な比較がまとまっています。

https://zenn.dev/catnose99/scraps/6780379210136f

これらのサービスはどれもGithubのリポジトリを連携すれば、メインブランチにpushしたタイミングで自動でCI/CDが走り、最新のデプロイを行なってくれます。

### Vercelが優れている点
VercelはReactフレームワークでもあるNext.jsの開発元の会社である為、React、Nextのサポートが行き届いています。

Nextで新機能がリリースされると、それがすぐにVercelで利用可能になることが多いです。

また、モダンフロントエンド開発で重要になってくる以下の要素でVercelは強みを持っています。

- パフォーマンス
- SSR(サーバーサイドレンダリング)、SG(静的サイト生成)の両方を使い分け可能

実際に現場でReactを触るならVercelは間違いなく選択肢に入ってくるので、この際に慣れておきましょう。

## 8-2 デプロイ前にプロジェクトを整理する
デプロイする前に初期状態のままになっているプロジェクト情報をカスタマイズしていきましょう！！

以下の状態を目指していきます。

![](https://storage.googleapis.com/zenn-user-upload/655e264145f1-20240507.png)

### ファビコンの設定・タイトル変更
まずはファビコンをViteのロゴからNetflixのロゴに変えましょう！

https://github.com/gunners6518/Netflix-clone/blob/master/public/favicon.ico

完成版のGitHubリポジトリにロゴがあるので、ここから入手して下さい。
以下の赤枠のボタンからダウンロードできます。

![](https://storage.googleapis.com/zenn-user-upload/4f7edcd2a29c-20240507.png)

次にこれをpublic配下におきましょう。
この際に、最初にいたvite.svgは削除してOKです。

![](https://storage.googleapis.com/zenn-user-upload/9b5e0c7ee3aa-20240507.png)

プロジェクトにファビコンを置けた所で、ファビコンの呼び出しとタイトル変更を行います。

index.htmlの以下の箇所を修正していきます。

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
　　　　　　　// 修正
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
　　　　　　　// 修正(タイトルは好みで！)
    <title>Netflix Clone</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

linkでファビコンを呼び出したいる箇所のpathをfavicon.icoに書き換え、
タイトルも変更します。

表示が変わった事を画面で確認出来たら、プロジェクト情報はOKです！

## 8-3 GitHubにコードをpushする
ここまでの流れで既にGithubリポジトリを作り、コミットしていた人はこの章を読み飛ばして大丈夫です。

VercelのデプロイはGithubにpushしてあるコードをベースに行います。
その為、デプロイ前にGithubの管理下にコードを保存する必要があります。

手元の環境にあるコードをGithub上に保存するまでの手順を解説していきます。

### Git・GitHub環境構築
まずは自身のPCでgitが使える状態になる必要があります。

以下のコマンドを叩いて下さい。

```bash
git --version
> git version 2.30.1 (Apple Git-130)
```

この様にgitのバージョン情報が返ってきた場合は、gitが既に使える状態になっているので、インストールは不要です。

gitのインストール・githubのアカウント作成がまだの方はこちらの手順で行なって下さい。

https://prog-8.com/docs/git-env

https://prog-8.com/docs/git-env-win

GitHubのリポジトリを作成し、手元のコードをpush出来たら完了です。

## 余談：現場レベルでのGit-flow

### 独学だとGitを習得するのは難しい

僕は未経験から独学でプログラミングを学び、仕事を得ていったのですが、最初はGitの扱いにとても苦労しました。

というのも、現場レベルでGitを扱う際はGit-flowという開発フローの考え方がありますが、これを深く理解せずに現場に入ってしまったんですね。

今自分が勤めているメガベンチャーや他の企業の新卒研修を見ていると漏れなくGitの講義があります。

しかし、独学でのプログラミング学習は誰かと共同で作業するわけでも、バグでユーザー影響が出る訳でもないので、Gitの扱いを学び損ねるパターンが多いです。

簡単にはなりますが、このタイミングで現場レベルで主流となっているGit-flowについて解説します。

### Git-flowとは
Git-flowは一言で表すと、「Gitブランチを使った開発戦略」ですね。

どのタイミングでどのブランチから新規ブランチを切って、どのブランチにマージするべきかといった考え方です。

元ネタになっているブログはこちらです。
原文なので難しいかもしれませんが、ある程度のキャリアのエンジニアはみんな読んでいると思うので、時間ある時にでもぜひ。

https://nvie.com/posts/a-successful-git-branching-model/

Git-flowにおける各ブランチの役割を簡単に説明していきます。

- main(master)：リリースされているコードを管理するブランチ。このブランチでは開発は行わない。このブランチのコードがユーザーにリリースされる
- develop：開発作業の基盤となるブランチ。
- feature：機能開発のブランチ。開発が終わったらdevelopにマージする
- release：developブランチからmainブランチにマージする前の最終チェックをするブランチです。releaseブランチの環境をQAにかけたりしてチェックをします。
- hotflix：バグ修正用のブランチです。リリース後に緊急度の高いバグが出た際に速やかに本番環境を修整する為に使います。releaseブランチを使った経路を省略し、直接mainとdevelopにマージするパターンが多いです。

ざっくりしたブランチの説明でした。
現場ごとにGit運用のルールはありますが、基本的に上記の概念は知ってる前提で話が進む事が多いです。

### 個人レベルで気をつける事
次に個人レベルで開発を進める際に覚えておくと良い情報です。

https://future-architect.github.io/articles/20240410a/

業務経験がある程度ないとピンと来ないかもしれませんが、ざっくりまとめる以下の事をしようねって感じです。

https://x.com/teriteri_code/status/1778257785626771522


### mainブランチへのマージはPR単位でCIを回す

これはCI/CDの設定なので、個人単位で気にする事ではなさそうなので解説を省略します。

### レビュー提出時のcommitは1つにまとめる

開発中は一定の区切りでcommitすると思いますが、PRのレビュー時にはそれを1つにまとめる事が望ましいです。

これはレビュー依頼時にcommitが1つにまとまっていた方がれビャーが見やすいからです。

例えば、PR作成時にテスト1、テスト2、テスト3とcommitを分けた状態でPRを作るとこうなります。

![](https://storage.googleapis.com/zenn-user-upload/ab09c601e97b-20240507.png)

これを1つのcommitにまとめると

![](https://storage.googleapis.com/zenn-user-upload/efa52c2f8d51-20240507.png)

この様にスッキリします。

### レビュー対応はコメントへの修正範囲ごとにバラバラとcommitする

先ほどPR提出時はcommitを1つにまとめるべきと言いましたが、レビューされてからはコメントに対して1対1でcommitするとレビュアーが差分を確認しやすいです。

1人2役でレビューしたので、自作自演ですが、以下のようなやり取りだと指摘箇所がcommitで修正されているかを確認出来るので、オススメです！

![](https://storage.googleapis.com/zenn-user-upload/c328e6b9846c-20240507.png)

### マージ前にrebaseする

これはチーム開発におけるコンフリクト解消の手段です。
コンフリクト解消の手段は現場ごとに違う(mergeを使う場合もある)ので、環境に柔軟に合わせていきましょう。

ただ、rebaseコマンドは少しクセがあるので、ある程度慣れておいた方が良いです。

https://zenn.dev/tana0102/articles/475d8952933af6

### マージはsquash merge

PRをマージする時は1つにまとめましょう！！という事ですね。
ここからSquash and mergeを選択する事で変更可能です。

![](https://storage.googleapis.com/zenn-user-upload/cf1d9fd83d8f-20240507.png)

- レビュー提出時のcommitは1つにまとめる
- レビュー対応はコメントへの修正範囲ごとにバラバラとcommitする
- マージはsquash merge

この3つを要約すると

- レビュー依頼とマージ後は全体の変更が分かれば良いのでcommitはまとめる
- レビュー中は前回との差分が知りたいので、細かくcommitする

という考えが基準となっています。

## 8-4 Vercelでデプロイする

### Vercelにログインする
まずはVercelにサインアップしましょう。先ほどGitHubアカウントを作っていると思うので、そちらを使うとスムーズです。

https://vercel.com

### GItHubリポジトリをインポートする
次にGitHubでnetflix-cloneのリポジトリをインポートします。
画像の赤枠のProjectをクリックします。

![](https://storage.googleapis.com/zenn-user-upload/537fb7a98e52-20240507.png)


その後、リポジトリの選択画面で対象のリポジトリのimportボタンを押します。
僕の場合はNetflix-cloneリポジトリです

![](https://storage.googleapis.com/zenn-user-upload/1a71442b002b-20240507.png)

そうすると設定画面に遷移します。

### 環境変数の設定

ローカルでは.envに入れていたTMDBのAPI_KEYをVercel側で参照できる様にする必要があります。

先ほど遷移したプロジェクト設定画面のEnvironment Variablesを開いて、環境変数を設定します。

Keyの部分にVITE_TMDB_API_KEY
ValueにAPI_KEY

これらを入力してAddをクリックします。

![](https://storage.googleapis.com/zenn-user-upload/5010a4ada23c-20240507.png)

Deployをクリックしたらデプロイが始まります。

**紙吹雪が舞ったら成功です！！**

![](https://storage.googleapis.com/zenn-user-upload/33092f50a97e-20240507.png)

ダッシュボードから、「Deployments」→最新のデプロイをクリックしましょう。

そこにあるブランチデプロイのURLを開いてみましょう！

![](https://storage.googleapis.com/zenn-user-upload/4cca8a688309-20240507.png)

どうです？うまく表示されましたか

![](https://storage.googleapis.com/zenn-user-upload/1915585f60cf-20240507.png)

https://netflix-clone-git-master-gunners6518s-projects.vercel.app/

正しくデプロイされてる事が確認出来たらこの章は完了です！
お疲れ様でした！！

### 追記(5/21)

vercelのビルドコマンドの設定が上手くいっていない為、ビルドでエラーが出るケースが発生する場合があるようです。

vercelでプロジェクトの「Setting」タブを開き、Build Commandが「npm run build」になっていれば解消します。!

![](https://storage.googleapis.com/zenn-user-upload/ffb716135ffe-20240521.png)




